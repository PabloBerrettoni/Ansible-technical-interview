---
- name: Instalar repositorios de Remi para PHP
  yum:
    name:
      - http://rpms.remirepo.net/enterprise/remi-release-7.rpm
    state: present

- name: Instalar yum-utils (necesario para manejar repos)
  yum:
    name: yum-utils
    state: present

- name: Habilitar repositorio Remi PHP 7.4
  command: yum-config-manager --enable remi-php74
  args:
    warn: false

- name: Instalar PHP 7.4 y m√≥dulos necesarios
  yum:
    name:
      - php
      - php-mysql
      - php-fpm
      - php-cli
      - php-common
      - php-gd
      - php-mbstring
      - php-xml
    state: latest

- name: Configurar PHP-FPM para trabajar con Nginx
  copy:
    src: www.conf
    dest: /etc/php-fpm.d/www.conf
    owner: root
    group: root
    mode: '0644'
  notify: restart php-fpm

- name: Crear directorio de sesiones PHP
  file:
    path: /var/lib/php/session
    state: directory
    owner: nginx
    group: nginx
    mode: '0770'

- name: Habilitar y arrancar PHP-FPM
  systemd:
    name: php-fpm
    enabled: yes
    state: started
